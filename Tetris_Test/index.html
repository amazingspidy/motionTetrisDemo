<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Matter.js Polygon Cutting Example</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.17.1/matter.min.js"></script>
</head>

<body>
    <script>
        const Engine = Matter.Engine,
            Render = Matter.Render,
            World = Matter.World,
            Bodies = Matter.Bodies,
            Vertices = Matter.Vertices,
            Bounds = Matter.Bounds,
            Vector = Matter.Vector;
        const engine = Engine.create();
        const render = Render.create({
            element: document.body,
            engine: engine
        });

        let OriginalPolygonRemoved = false;
        const blockSize = 80;
        Render.run(render);

        const mouse = Matter.Mouse.create(render.canvas),
            mouseConstraint = Matter.MouseConstraint.create(engine, {
                mouse: mouse
            });

        World.add(engine.world, mouseConstraint);

        // 여러 폴리곤을 가진 복합체 생성
        const compoundBody = Bodies.fromVertices(200, 200, [
            { x: 0, y: 0 },
            { x: blockSize, y: 0 },
            { x: blockSize, y: blockSize },
            { x: 0, y: blockSize }
        ], {
            isStatic: false,
            render: {
                fillStyle: 'blue'
            }
        });

        // 벽 생성
        const wall = Bodies.rectangle(400, 400, 800, 20, {
            isStatic: true,
            render: {
                fillStyle: 'gray'
            }
        });

        // 복합체와 벽을 세계에 추가
        World.add(engine.world, [compoundBody, wall]);

        // 마우스 클릭 이벤트
        Matter.Events.on(mouseConstraint, 'mousedown', (event) => {
            console.log(compoundBody);
            if (OriginalPolygonRemoved) {
                return;
            }
            World.remove(engine.world, compoundBody);
            OriginalPolygonRemoved = true;
            
            const halfWidth = blockSize / 2;
            const vertices1 = [
                { x: compoundBody.position.x - halfWidth, y: compoundBody.position.y - halfWidth },
                { x: compoundBody.position.x, y: compoundBody.position.y - halfWidth },
                { x: compoundBody.position.x, y: compoundBody.position.y + halfWidth },
                { x: compoundBody.position.x - halfWidth, y: compoundBody.position.y + halfWidth },
            ];
            const vertices2 = [
                { x: compoundBody.position.x, y: compoundBody.position.y - halfWidth },
                { x: compoundBody.position.x + halfWidth, y: compoundBody.position.y - halfWidth },
                { x: compoundBody.position.x + halfWidth, y: compoundBody.position.y + halfWidth },
                { x: compoundBody.position.x, y: compoundBody.position.y + halfWidth },
            ];
            const body1 = Bodies.fromVertices(compoundBody.position.x - halfWidth / 2, compoundBody.position.y, vertices1, {
                render: { fillStyle: 'blue' }
            });
            const body2 = Bodies.fromVertices(compoundBody.position.x + halfWidth / 2, compoundBody.position.y, vertices2, {
                render: { fillStyle: 'blue' }
            });

            console.log(body1, body2);

            // 세계에 추가
            World.add(engine.world, [body1, body2]);
        });

        Engine.run(engine);
    </script>
</body>